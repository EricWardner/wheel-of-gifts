import { useState, useEffect } from 'react';

const SpinTheWheelTitle = ({ isSpinning = false, width = '154.47429mm', height = '29.421228mm' }) => {
   const [activePathIndex, setActivePathIndex] = useState(-1);
   const [isComplete, setIsComplete] = useState(false);
   const totalPaths = 12; // Total number of paths in the SVG
   const animationDuration = 10000; // 10 seconds to match the wheel

   if (window.innerWidth < 400) {
      width = `${window.innerWidth*.9}`;
   }

   // Function to calculate the interval time based on progress
   const getIntervalTime = (progress: number) => {
      // Start very fast (50ms) and slow down to 800ms
      const startSpeed = 50;
      const endSpeed = 800;
      // Use cubic-bezier-like easing
      const t = progress;
      const bezierY = t * t * (3 - 2 * t); // Cubic easing
      return startSpeed + (endSpeed - startSpeed) * bezierY;
   };

   useEffect(() => {
      if (isSpinning) {
         setIsComplete(false);
         let currentIndex = 0;
         const startTime = Date.now();
   
         const animate = () => {
            const elapsedTime = Date.now() - startTime;
            const progress = Math.min(elapsedTime / animationDuration, 1);
            const intervalTime = getIntervalTime(progress);
   
            setActivePathIndex(currentIndex);
            currentIndex = (currentIndex + 1) % totalPaths;
   
            if (elapsedTime < animationDuration) {
               setTimeout(animate, intervalTime); // Schedule the next frame
            } else {
               setIsComplete(true);
            }
         };
   
         animate();
      }
   }, [isSpinning]);

   const getColor = (index: number) => {
      if (index === -1) return '#000000';
      return `hsl(${index * 360 / totalPaths}, 70%, 60%)`;
   };

   const getPathStyle = (index: number) => {
      return {
         fillOpacity: 0,
         strokeWidth: 1.065,
         stroke: isComplete ? getColor(index) : getColor(activePathIndex === index ? index : -1),
      }
   };

   return (
      <svg
         key={`svg-${isComplete}`}
         width={width}
         height={height}
         viewBox="0 0 154.47429 29.421228"
         version="1.1"
         xmlns="http://www.w3.org/2000/svg">
         <g
            id="layer1"
            transform="rotate(90,139.74123,125.09806)">
            <path
               style={getPathStyle(0)}
               d="m 26.531256,259.68447 c 0.671727,0.86732 1.537158,1.53826 2.429756,2.16309 0.968267,0.67778 1.984351,1.34141 3.037194,1.88156 0.564201,0.28948 1.65788,0.89921 2.2816,0.37039 1.74311,-1.47786 -0.267763,-6.81851 2.355678,-9.09676 0.331084,-0.28752 0.78453,-0.54874 1.229694,-0.60744 2.459762,-0.32436 6.589797,5.62404 5.481767,6.81517 -0.120576,0.12962 -0.306189,0.17779 -0.459282,0.26669"
               id="path53" />
            <path
               id="path55"
               style={getPathStyle(1)}
               d="m 28.423637,252.87566 c -1.985343,1.90799 -6.114796,-2.77648 -4.740989,-4.44468 1.092025,-1.32603 6.354879,1.02641 7.467055,1.67416 0.517951,0.30167 1.231952,0.92236 1.697814,1.29708 0.206092,0.16576 0.262994,0.25824 0.30229,0.1993 m -5.573316,1.6593 c 0.354719,-0.12395 1.081869,-0.10279 1.437991,-0.2353 1.148595,-0.42739 2.324121,-0.74746 3.452031,-1.24451 1.425816,-0.62833 2.753699,-1.45078 4.103918,-2.22234 1.443935,-0.8251 3.121062,-1.60791 3.200167,-3.46685" />
            <path
               style={getPathStyle(2)}
               d="m 22.763656,243.01394 c 3.102631,-2.06851 6.492764,-4.21389 9.985703,-5.57066 0.338921,-0.13164 2.214446,-0.46427 2.296417,-0.87412"
               id="path56" />
            <path
               style={getPathStyle(3)}
               d="m 34.576407,230.42972 c -2.054484,0.95625 -4.447477,0.97614 -6.68183,1.17043 -1.423241,0.12376 -2.830407,0.35939 -4.222442,0.68151 -1.256298,0.29072 -2.529467,0.63227 -3.807606,0.81486 -0.335486,0.0479 0.646389,-0.20512 0.963013,-0.32594 0.860949,-0.32852 1.705495,-0.67563 2.503834,-1.1408 2.466619,-1.43724 5.473444,-2.68792 7.392978,-4.85951 0.421412,-0.47675 2.487827,-2.84881 1.54082,-3.58537 -0.730528,-0.56819 -2.590136,-0.0725 -3.333507,0.0444 -2.691691,0.42357 -5.332902,1.2702 -7.970784,1.94084 -0.337017,0.0857 -1.612541,0.42097 -2.029736,0.563 -0.821919,0.2798 -0.829673,0.48512 -0.829673,0.42965 0,-0.37382 -0.04539,-0.1287 0.622255,-0.41484"
               id="path57" />
            <path
               id="path59"
               style={getPathStyle(4)}
               d="m 19.519909,214.50045 c -0.05432,-0.35063 -0.10667,-0.70158 -0.162972,-1.05191 -0.295725,-1.84006 -1.348305,-3.47403 -2.251969,-5.06692 -0.280139,-0.49381 -0.968669,-1.32478 -1.00746,-1.92603 -0.01635,-0.25346 0.214029,-0.46141 0.340759,-0.68152 m 2.194637,4.8447 c 1.582193,-1.20347 3.663156,-1.26434 5.526213,-1.77787 3.085143,-0.85039 6.081515,-1.52601 9.304188,-1.52601" />
            <path
               id="path62"
               style={getPathStyle(5)}
               d="m 25.003606,201.29629 c -0.362928,-1.25291 -2.490909,-3.53846 -1.451927,-4.88914 m -8.883609,2.01637 c 4.82144,-0.2257 9.213248,-3.18629 14.104438,-2.80015 m -11.437633,6.10402 c 0.794629,0.14631 1.577475,0.0365 2.370494,-0.0296 2.911766,-0.24265 5.73966,-0.68257 8.622671,-1.1408 0.591825,-0.0941 1.186008,-0.17285 1.77787,-0.26668 0.514337,-0.0815 1.108377,0.0117 0.13334,-0.25186" />
            <path
               id="path68"
               style={getPathStyle(6)}
               d="m 29.741696,190.50257 c -0.390144,-0.40989 -0.811732,-0.79201 -1.17043,-1.22969 -1.029052,-1.25563 -1.948963,-4.45453 -1.837133,-6.10402 0.03485,-0.51406 0.304219,-0.83314 0.592623,-1.22969 m -4.119438,9.58159 c -1.776903,-0.54471 -2.292823,-2.85178 -1.51119,-4.41504 m -4.167567,6.15815 c -0.271619,-0.26668 -0.581905,-0.49899 -0.814857,-0.80004 -0.792667,-1.02437 -1.007382,-6.33568 -0.488914,-7.43742 0.124362,-0.26427 0.279792,-0.25684 0.548176,-0.37039 m 0.300923,8.46058 c 0.766776,-0.0986 1.508413,-0.30221 2.251969,-0.50373 1.158726,-0.31405 2.294753,-0.74506 3.466847,-1.00746 1.690436,-0.37846 3.467168,-0.36408 5.185455,-0.54818 0.4156,-0.0445 1.961862,-0.006 1.659345,-0.74078" />
            <path
               style={getPathStyle(7)}
               d="m 15.021425,169.10359 c 0.251864,0.24693 0.489339,0.50944 0.755594,0.74078 0.385599,0.33503 3.120148,0.291 3.555741,0.29631 3.011582,0.0367 6.106647,0.006 9.081954,-0.50373 0.316952,-0.0543 2.11769,-0.22767 2.177891,-0.82967 0.04822,-0.4822 -1.154126,-1.00536 -1.437111,-1.17043 -1.340848,-0.78216 -2.764909,-1.39098 -4.252074,-1.83714 -0.860886,-0.25826 -1.9303,-0.3503 -2.740883,-0.75559 -0.617322,-0.30866 1.266727,-0.50582 2.400125,-0.71115 1.463334,-0.26509 7.963679,-1.24047 7.807813,-3.31869 -0.185806,-2.4774 -7.755285,-4.00802 -9.600499,-4.13355 -0.474632,-0.0323 -1.530147,-0.12967 -1.851948,0.38521"
               id="path69" />
            <path
               id="path72"
               style={getPathStyle(8)}
               d="m 26.912755,153.11969 c -0.401967,-2.02154 0.227271,-4.27224 1.003973,-6.07091 m -7.294047,-0.92046 c 3.606148,0.46277 7.250275,0.49916 10.874641,0.74078 0.53767,0.0358 1.598427,-0.11132 1.496372,0.63707 m -13.540961,4.29368 c 3.2358,1.00437 6.719706,1.2297 10.089414,1.57045 1.095317,0.11076 2.229798,0.30339 3.333507,0.20742" />
            <path
               id="path76"
               style={getPathStyle(9)}
               d="m 33.400957,141.38246 c 0.336381,-2.69887 0.04845,-5.69682 1.348219,-8.1782 m -5.953215,6.2598 c -0.03485,-0.20819 -0.18964,-1.01172 -0.170459,-1.28281 0.03854,-0.54475 0.969179,-2.87423 1.937056,-2.98279 m -6.863852,3.64435 c 0.187513,-1.48296 0.34611,-2.98198 0.666701,-4.44467 0.113727,-0.51888 0.440462,-1.00365 0.518546,-1.51119 m -1.53279,5.42541 c 2.647673,1.19978 5.591329,1.38413 8.38562,2.089 0.373118,0.0941 1.514637,0.64047 1.881579,0.32594" />
            <path
               id="path80"
               style={getPathStyle(10)}
               d="m 35.649807,129.19914 c -0.452313,-2.11757 -0.09436,-4.26779 1.096354,-6.07439 m -6.501406,4.68553 c 0.904115,-0.53045 1.427543,-1.37038 2.014918,-2.19271 m -5.814428,1.21874 c 0.562263,-1.67147 0.429977,-3.67602 1.392663,-5.20027 m -1.982428,5.53388 c 2.608996,0.3745 5.244791,0.66912 7.763367,1.48156 0.464331,0.14979 1.832018,0.35462 2.133444,0.78523" />
            <path
               style={getPathStyle(11)}
               d="m 24.145077,111.90355 c 2.76013,3.60898 7.455696,5.23988 11.748759,6.1781 0.926166,0.20241 1.85316,0.43401 2.785329,0.60744 0.528617,0.0983 1.137439,0.148 1.111171,0.0889 -0.250505,-0.56364 -0.642067,-1.08499 -0.859306,-1.70379 -0.560123,-1.59551 -1.310346,-5.42228 0.888937,-6.20773"
               id="path81" />
         </g>
      </svg>
   );
};

export default SpinTheWheelTitle;